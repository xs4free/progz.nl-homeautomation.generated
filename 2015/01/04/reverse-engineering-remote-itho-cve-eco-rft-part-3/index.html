<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.51" />

    
    
    

<title>Reverse engineering remote Itho CVE ECO RFT – Part 3 • Rogier&#39;s blog</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reverse engineering remote Itho CVE ECO RFT – Part 3"/>
<meta name="twitter:description" content="Now that I have saved the data from the logical analyzer, it&rsquo;s time to do the actually analysis. The analyzer software helped me interpret the SPI protocol into hexadecimal values (so I didn&rsquo;t have to count each bit individually). But still there is a lot of communication between the ATMEL microprocessor and the CC1150 chip to changes the speed of the Itho ventilationbox.
 The first thing I noticed was that when you press a button once, 3 identical messages are transmitted using the CC1150."/>

<meta property="og:title" content="Reverse engineering remote Itho CVE ECO RFT – Part 3" />
<meta property="og:description" content="Now that I have saved the data from the logical analyzer, it&rsquo;s time to do the actually analysis. The analyzer software helped me interpret the SPI protocol into hexadecimal values (so I didn&rsquo;t have to count each bit individually). But still there is a lot of communication between the ATMEL microprocessor and the CC1150 chip to changes the speed of the Itho ventilationbox.
 The first thing I noticed was that when you press a button once, 3 identical messages are transmitted using the CC1150." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.progz.nl/blog/2015/01/04/reverse-engineering-remote-itho-cve-eco-rft-part-3/" /><meta property="article:published_time" content="2015-01-04T01:41:32&#43;01:00"/>
<meta property="article:modified_time" content="2015-01-04T01:41:32&#43;01:00"/>


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/blog/scss/hyde-hyde.173e0dc3bb8c6a72b7f6415bdbae34b6521efd304b087c69ab48bddcf583090a.css" integrity="sha256-Fz4Nw7uManK39kFb2640tlIe/TBLCHxpq0i93PWDCQo=">


<link rel="stylesheet" href="/blog/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>


    <body class="theme-progz ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.progz.nl/blog">Rogier&#39;s blog</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://www.progz.nl/blog/img/Rogier-Reedijk.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Rogier&#39;s blog</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/blog/about/">
						<span>About</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/xs4free" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://facebook.com/rogier.reedijk" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/xs4free" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://linkedin.com/in/rogierreedijk" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 Rogier Reedijk
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>Reverse engineering remote Itho CVE ECO RFT – Part 3</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jan 4, 2015
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/blog/categories/homeautomation">HOMEAUTOMATION</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/blog/tags/arduino">arduino</a>
           
      
          <a class="badge badge-tag" href="/blog/tags/cc1150">cc1150</a>
           
      
          <a class="badge badge-tag" href="/blog/tags/itho">itho</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 9 min read
</div>


  </header>
  
  
  <div class="post">
    <p>Now that I have saved the data from the logical analyzer, it&rsquo;s time to do the actually analysis. The analyzer software helped me interpret the SPI protocol into hexadecimal values (so I didn&rsquo;t have to count each bit individually). But still there is a lot of communication between the ATMEL microprocessor and the CC1150 chip to changes the speed of the Itho ventilationbox.</p>



<figure class="no-photoswipe">
    <img src="/blog/2015/01/04/reverse-engineering-remote-itho-cve-eco-rft-part-3/Screenshot-4-all-three-blocks_hu7389e4886a8cc981bb3bca3d2d7c7fb3_92354_750x750_fit_box_2.png" alt="Itho RFT All three messages" class="img-fluid" />
	
</figure>

<p>The first thing I noticed was that when you press a button once, 3 identical messages are transmitted using the CC1150. From what I&rsquo;ve read this is very common in RF-communication, this way you have a higher change that at least one message will arrive at the other end. The transmission of one message takes about 45 milliseconds then the remote waits 55 miliseconds to send the next message. In total the remote is out of sleep mode for a maximum of 245 milliseconds after 1 button is pressed.</p>



<figure class="no-photoswipe">
    <img src="/blog/2015/01/04/reverse-engineering-remote-itho-cve-eco-rft-part-3/Screenshot-3-one-block_hu796a523505671402ef5eee3a032ec190_88381_750x750_fit_box_2.png" alt="Itho RFT one messages" class="img-fluid" />
	
</figure>

<p>Each message consist of 5 things:</p>

<ol>
<li>SPI communication to initialize the CC1150</li>
<li>serial communication to sent the first part of the message</li>
<li>SPI communication to reset and re-initialize the CC1150 for the second time</li>
<li>serial communication to sent the second part of the message</li>
<li>SPI communication to turn off the CC1150</li>
</ol>

<p>These 5 steps are repeated identically 3 times for each button you press on the remote. According to the datasheet, the CC1150 would have been able to sent data without using the serial communication mode, it would even perform better if they used this method (since the CC1150 can take care of all the timing aspects). But Itho choose to use the old serial communication method, probably for making the protocol backwards-compatible with older Itho ventilationboxes that do not have a CC1150 yet.</p>

<p>I started reverse engineering the SPI communication first. For this the <a href="http://www.ti.com/lit/ds/symlink/cc1150.pdf">CC1150 datasheet</a> and the <a href="http://cybergibbons.com/category/alarms-2/friedland-response-reverse-engineering/">blogs from @cybergibbons</a> where invaluable. To make things a little bit easier for myself, I created an spreadsheet with the captured data on one tab and several lookup tables for Command Strobes and Config Registers from the datasheet on the next. This way I could easily translate the bytes being sent. The first part of the sheets looks like this:</p>

<table>
<thead>
<tr>
<th>Time [s]</th>
<th>Packet ID</th>
<th>MOSI</th>
<th>Strobe</th>
<th>Register</th>
<th>MOSI meaning</th>
<th>Register/ Command/ Value</th>
<th>Value meaning</th>
</tr>
</thead>

<tbody>
<tr>
<td>0.000257875</td>
<td>0</td>
<td>0x30</td>
<td>x</td>
<td></td>
<td>Reset chip</td>
<td>SRES</td>
<td></td>
</tr>

<tr>
<td>0.000425875</td>
<td>1</td>
<td>0x02</td>
<td></td>
<td>x</td>
<td>GDO0 output pin configuration</td>
<td>IOCFG0</td>
<td></td>
</tr>

<tr>
<td>0.000441875</td>
<td>1</td>
<td>0x2E</td>
<td></td>
<td></td>
<td>0x2E</td>
<td>0x2E</td>
<td>High impedance (3-state).</td>
</tr>

<tr>
<td>0.000516125</td>
<td>2</td>
<td>0x0D</td>
<td></td>
<td>x</td>
<td>Frequency control word, high byte</td>
<td>FREQ2</td>
<td></td>
</tr>

<tr>
<td>0.000532250</td>
<td>2</td>
<td>0x21</td>
<td></td>
<td></td>
<td>0x21</td>
<td>0x21</td>
<td></td>
</tr>

<tr>
<td>0.000606500</td>
<td>3</td>
<td>0x0E</td>
<td></td>
<td>x</td>
<td>Frequency control word, middle byte</td>
<td>FREQ1</td>
<td></td>
</tr>

<tr>
<td>0.000622500</td>
<td>3</td>
<td>0x65</td>
<td></td>
<td></td>
<td>0x65</td>
<td>0x65</td>
<td></td>
</tr>

<tr>
<td>0.000696750</td>
<td>4</td>
<td>0x0F</td>
<td></td>
<td>x</td>
<td>Frequency control word, low byte</td>
<td>FREQ0</td>
<td></td>
</tr>

<tr>
<td>0.000712750</td>
<td>4</td>
<td>0x6A</td>
<td></td>
<td></td>
<td>0x6A</td>
<td>0x6A</td>
<td>868,299865 MHz</td>
</tr>
</tbody>
</table>

<p>The first 3 columns (Time, Packet ID and MOSI) came from the logical analyzer. The 2 columns after that (Strobe Register) I&rsquo;ve added myself. These 2 columns indicate which lookup table the next two columns (MOSI meaning, Register/Command/Value) should use to lookup the meaning of the MOSI value. The last column I&rsquo;ve added manually to translate the values of each register/command to readable text.</p>

<p>Let&rsquo;s look at 3 examples. The first packet ID 0 sents MOSI hexadecimal value 0x30 to the CC1150. In the datasheet on page 42 in table 25 this value translates to Strobe Name &ldquo;SRES&rdquo; with the description &ldquo;Reset chip&rdquo;. This sounds pretty normal; start by resetting the configuration to the default values before configuring anything else (remember the chips comes out of sleep mode after each button press).</p>

<p>The second packet has ID 1. It consists of 2 bytes. The first byte has hexadecimal value 0x02. The second byte has value 0x2E. Looking up up the first byte (0x02) in the datasheet, on page 43 table 26, shows that this is a register address called IOCFG0. The second byte (0x2E) is the value written to it. Looking at page 45 shows that this register consists of one byte and the 8 bits in this byte configure 3 seperate fields:</p>

<table>
<thead>
<tr>
<th>Bit</th>
<th>Field Name</th>
<th>Reset</th>
<th>R/W</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>7</td>
<td>GDO_DS</td>
<td>0</td>
<td>R/W</td>
<td>Set high (1) or low (0) output drive strength on the GDO pins.</td>
</tr>

<tr>
<td>6</td>
<td>GDO1_INV</td>
<td>0</td>
<td>R/W</td>
<td>Invert output, i.e. select active low (1) / high (0).</td>
</tr>

<tr>
<td>5:0</td>
<td>GDO1_CFG[5:0]</td>
<td>46 (0x2E)</td>
<td>R/W</td>
<td>Default is tri-state (See Table 24 on page 38).</td>
</tr>
</tbody>
</table>

<p>If we translate hexadecimal value 0x2E to binary (bits), it becomes 00101110. Looking at the table above GDO_DS has bit 7 (the most significant bit, the first bit on the left) which has value 0, so GDO_DS is low. GDO1_INV has bit 6 (the second bit from the left) which is also 0, so GDO1_INV is high. The 6 other bits (101110) are the value for GDO1_CFG. To know what they do, we need to lookup table 24 on page 38 in the datasheet. There it says that 0x2E (the hexidecimal value for binary 101110) is &ldquo;High impedance (3-state)&rdquo;. In short this means the GDO1 pin outputs data depending on the state the CC1150 is in (either a SPI signal output, or a clock signal, or a temperature value).</p>

<p><strong>UPDATE: Two very observant people noticed a flaw in my calculation below. So I&rsquo;ve striked out and corrected the errors, which have a significant effect on the frequency.</strong></p>

<p>The next 3 packets sent to the CC1150 configure registers FREQ2, FREQ1 and FREQ0. In the datasheet on page 47 it says we can calculate the value of FREQ using these three register values. All we have to do is paste the values of the 3 registers after each other: 0x21 0x65 <del>0x5A</del> 0x6A. In binary notation this would be 00100001 01100101 <del>01011010</del> 01101010. Using a calculator we can translate this long binary number to a decimal: <del>2188634</del> 2188650.</p>

<p>Now that we have FREQ we can calculate the carrier frequency using the formule on page 34 in the datasheet:<br />
<code>F_CARRIERFREQ = FXOSC / 2 ^ 16 * (FREQ + CHAN * ((256 + CHANSPC_M) * 2 ^ (CHANSPC_E - 2)))</code></p>

<p>We know that the remote uses an oscillator running at 26MHz from the photo in my earlier blog. So FXOSC is 26000000 (Hz). The values for the other registers used in this formule appear further down the captured data (which I haven&rsquo;t shown in the first table to keep this blog post &lsquo;short&rsquo;). The values are: CHANSPC_M = 248, CHANSPC_E = 2 and CHAN = 0. If we fill these values into the formula we get:</p>

<p><code>F_CARRIERFREQ =26000000 / 2 ^ 16 * (&lt;del&gt;2188634&lt;/del&gt; 2188650+ 0 * ((256 + 248) * 2 ^ (2-2)))</code><br />
<code>F_CARRIERFREQ =26000000 / 65536 *</code> <del>2188634</del><code> 2188650</code><br />
<code>F_CARRIERFREQ =</code> <del>866699064</del> <code>868299865 Hz</code><br />
<code>F_CARRIERFREQ =</code> <del>866,699064</del> <code>868,299865 MHz</code></p>

<p>Looking at all the data before the first serial transmission, we see the following SPI strobe commands/registers set:</p>

<ul>
<li>SRES - Reset the chip</li>
<li>IOCFG0 = GDO0 is configured as input (for serial TX data).</li>
<li>IOCFG1 = Serial Clock. Synchronous to the data in synchronous serial mode. In TX mode, data is sampled by CC1150 on the rising edge of the serial clock when GDOx_INV=0.</li>
<li>FREQ2, FREQ1, FREQ0 = 868,299865 MHz</li>
<li>MDMCFG4, MDMCFG3 = 4004,47845458984375 baud</li>

<li><p>MDMCFG2, MDMCFG1, MDMCFG0</p>

<ul>
<li>MOD_FORMAT = 2-FSK</li>
<li>MANCHESTER_EN = Disable</li>
<li>SYNC_MODE = No preamble/sync word</li>
</ul></li>

<li><p>CHANNR = 0</p></li>

<li><p>DEVIATN = 25,390625 KHz</p></li>

<li><p>FREND0</p>

<ul>
<li>LODIV_BUF_CURRENT_TX = 2</li>
<li>PA_POWER = 7</li>
</ul></li>

<li><p>MCSM0</p>

<ul>
<li>FS_AUTOCAL = Automatically calibrate when going from TX back to IDLE</li>
<li>PO_TIMEOUT = 64</li>
</ul></li>

<li><p>FSCAL3, FSCAL2, FSCAL1 = all default values</p></li>

<li><p>FSTEST, TEST2, TEST1, TEST0 = all values given by SmartRF studio according to the datasheet</p></li>

<li><p>PKTCTRL0</p>

<ul>
<li>WHITE_DATA = off</li>
<li>PKT_FORMAT = Serial Synchronous mode, data in on GDO0</li>
<li>CRC_EN = disabled</li>
<li>LENGTH_CONFIG = Infinite packet length packets</li>
</ul></li>

<li><p>ADDR = Broadcast</p></li>

<li><p>PKTLEN = 255</p></li>

<li><p>SNOP = Burst write PATABLE</p></li>

<li><p>STX = Enable TX. Perform calibration first if MCSM0.FS_AUTOCAL=1</p></li>
</ul>

<p>I have removed the duplicate strobe commands and registers being set. Hopefully when I write my own code I don&rsquo;t have to set the same register multiple times to configure the CC1150 correctly. In the datasheet I didn&rsquo;t find any reference that setting the same register multiple times would be necessary, so the logged data I observed could simply be a programming error made by Itho, or it is necessary for the CC1150 and isn&rsquo;t specified in the datasheet.</p>

<p>The next step is to decode the recorded serial data:


<figure class="no-photoswipe">
    <img src="/blog/2015/01/04/reverse-engineering-remote-itho-cve-eco-rft-part-3/Screenshot-2-GDO0-simple-parallel_hu94421d4197fe9cbe0240cda1b7ff7f9b_70038_750x750_fit_box_2.png" alt="Itho RFT first serial part" class="img-fluid" />
	
</figure></p>

<p>This is a bit more fuzzy-logic than the SPI data, since it isn&rsquo;t specified in the datasheet for CC1150 and is specific for the Itho ventilationbox. From the registers set with SPI I have gathered that the data will be sent over GDO0 (channel 4 in the picture) and that this data needs to be transmitted on the rising edge of the clock signal provided by the CC1150 on the SO (channel 1 in the picture). Luckily the logical analyzer can be configured to decode the same channel using 2 different protocols (SPI and Simple Parrallel). Exporting this parallel data results in:</p>

<table>
<thead>
<tr>
<th>Time [s]</th>
<th>binary value</th>
<th>Last bit</th>
<th>Byte value</th>
</tr>
</thead>

<tbody>
<tr>
<td>0.004950750000000</td>
<td>0b  1111  1111  1111  1111</td>
<td>1</td>
<td></td>
</tr>

<tr>
<td>0.005075625000000</td>
<td>0b  1111  1111  1111  1110</td>
<td>0</td>
<td></td>
</tr>

<tr>
<td>0.005200500000000</td>
<td>0b  1111  1111  1111  1111</td>
<td>1</td>
<td></td>
</tr>

<tr>
<td>0.005325375000000</td>
<td>0b  1111  1111  1111  1110</td>
<td>0</td>
<td></td>
</tr>

<tr>
<td>0.005450250000000</td>
<td>0b  1111  1111  1111  1111</td>
<td>1</td>
<td></td>
</tr>

<tr>
<td>0.005575125000000</td>
<td>0b  1111  1111  1111  1110</td>
<td>0</td>
<td></td>
</tr>

<tr>
<td>0.005700000000000</td>
<td>0b  1111  1111  1111  1111</td>
<td>1</td>
<td></td>
</tr>

<tr>
<td>0.005824875000000</td>
<td>0b  1111  1111  1111  1110</td>
<td>0</td>
<td>10101010</td>
</tr>
</tbody>
</table>

<p>Only the last bit of the second column is relevant data (it actually changes), so I&rsquo;ve added the third column to show only that bit. I&rsquo;m assuming the data is being sent using one byte at a time, so after every 8 bits I calculate the binary value of the byte and show this in the fourth column.</p>

<p>The first serial transmission contains exactly 160 bit values, which translates to 20 byte values. For the second serial transmission I&rsquo;m still a bit uncertain how many byte values are sent. I&rsquo;ve recorded multiple traces for the same button press and the number of bits varies between 404 and 408. Most likely my logical analyzer isn&rsquo;t fast enough to record all bits being sent and that is why the total number of recorded bits varies. For the moment I&rsquo;m going to assume 408 is the correct value, since this means there are 51 bytes being sent. I will have to look at the recorded traces of the other buttons to determine the exact number or else simply try to write some code and see when the ventilationbox actually changes speed. Let&rsquo;s write some code for the Itho ventilationbox and the CC1150 chip next!</p>

<p><strong>Other posts in this serie: </strong><a href="https://www.progz.nl/blog/2014/12/reverse-engineering-remote-itho-cve-eco-rft-part-1/" title="Reverse engineering remote Itho CVE ECO RFT – Part 1">Part 1</a>, <a href="https://www.progz.nl/blog/2014/12/reverse-engineering-remote-itho-cve-eco-rft-part-2/" title="Reverse engineering remote Itho CVE ECO RFT – Part 2">Part 2</a>, <a href="https://www.progz.nl/blog/2015/02/reverse-engineering-remote-itho-cve-eco-rft-part-4/" title="Reverse engineering remote Itho CVE ECO RFT – Part 4">Part 4</a>, <a href="https://www.progz.nl/blog/2015/02/reverse-engineering-remote-itho-cve-eco-rft-part-5/" title="Reverse engineering remote Itho CVE ECO RFT – Part 5">part 5</a>, <a href="https://www.progz.nl/blog/2015/05/reverse-engineering-remote-itho-cve-eco-rft-part-6/">Part 6</a></p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="https://www.progz.nl/blog/2015/02/05/reverse-engineering-remote-itho-cve-eco-rft-part-4/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Reverse engineering remote Itho CVE ECO RFT – Part 4</span>
    </a>
    
    
    <a href="https://www.progz.nl/blog/2014/12/30/reverse-engineering-remote-itho-cve-eco-rft-part-2/" class="navigation-next">
      <span class="navigation-tittle">Reverse engineering remote Itho CVE ECO RFT - Part 2</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <section class="comments-area">
  <a id="comments"></a>

  
  

  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
         

    
    <h3><i class="fas fa-comment-alt"></i> 15 replies on “Reverse engineering remote Itho CVE ECO RFT – Part 3”</h3>

    <ol>
    
      
      <li>
        <article id="comment-10">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/592E9578E7AC85E458696E9BE0BD9BDC?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Gerben bom
                
              </div>
              <small>
                <a href="#comment-10" title="Link naar deze reactie">
                  <time>Wednesday 7 Jan 2015 om 19:13:44</time>
                  
                </a>
              </small>
              <p>Hi Rogier, good progress! I also have an Itho box and which i would like to couple to my rfxcom.
Thanks for the good worrk.</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  
    <li>
      <article id="comment-11">
          <div class="d-flex flex-row">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/7F2A9FD369018735070D34C0331FE9C5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                rogier reply to Gerben bom
                
              </div>
              <small>
                <a href="#comment-11" title="Link naar deze reactie">
                  <time>Wednesday 7 Jan 2015 om 22:37:48</time>
                  
                </a>
              </small>
              <p><p>Hi Gerben,
I have no experience yet with a rfxcom. But if it can sent an rf signal on a specific channel with a specific modulation than it should be possible to sent the same signals as the Itho remote. When I have a working example with a CC1150 or CC1101 chipset, I might also look at sending the signal with a simpeler rf-chipset and/or a rfxcom.
Keep on reading my blog for further updates!</p>

<p>Regards, Rogier.</p>
</p>
            </div>
          </div>      
        </article>
        <hr class="blog-seperator"/>
    </li>
  

  

  

  

  

  

  

  

  

  

  

  

  

  

</ol>
      </li>
      
    
      
    
      
      <li>
        <article id="comment-12">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/C36C14C4A21E4150189E96A871C507A3?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Pieter
                
              </div>
              <small>
                <a href="#comment-12" title="Link naar deze reactie">
                  <time>Friday 9 Jan 2015 om 11:00:35</time>
                  
                </a>
              </small>
              <p><p>Hi Rogier,</p>

<p>Nice job! I have the same wish, but not the same skills:-) You lost me in this third part, lol.
But form what I understand, you&rsquo;ll be able to write some code now, so that the Itho can be controlled? Great!
Would that be a generic code? Or is there some kind of ID that makes each box unique and a generic code would not work?</p>

<p>Anyhow, keep up the good work. I can&rsquo;t wait.</p>
</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  

  

  
    <li>
      <article id="comment-13">
          <div class="d-flex flex-row">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/7F2A9FD369018735070D34C0331FE9C5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                rogier reply to Pieter
                
              </div>
              <small>
                <a href="#comment-13" title="Link naar deze reactie">
                  <time>Friday 9 Jan 2015 om 11:52:55</time>
                  
                </a>
              </small>
              <p><p>Hi Pieter,</p>

<p>I must admit this last post was very in-depth. This is all very new to me as well, but I&rsquo;m trying to document my steps as good as possible. I&rsquo;ve got a background in software enginering, but not in electrical enginering nor in embedded software, so bare with me. :-)</p>

<p>But your summary is right, I&rsquo;ll be able to write some code now that controls the Itho. I&rsquo;m currently busy writing the code, when that&rsquo;s finished I&rsquo;ll write a follow-up post about it.</p>

<p>As far as I can tell, only the remote controls have a unique id. When you first power-up the ventilation box you have a short time (i think about a minute) to register all remote-controls in the house with the box. You do this by pressing two buttons on the remote at the same time. The remote then sents out a signal with it&rsquo;s id and from that point on that remote is able to control the ventilationbox.
The messages that I&rsquo;ve recorded contain the unique id for my own remote. This id can be registered with any Itho ventilationbox, so my code should work on all boxes.</p>

<p>It would be even better if I had a second remote to test with, because then I could determine which bytes of the protocol contain the id.
When I&rsquo;ve seen that the code works, I&rsquo;ll be asking around for another remote control that I can borrow to see if I can give each home-automation-controller a unique id.</p>

<p>Thanks for your reply! (it&rsquo;s motivating to hear that other people would like to use the same code)</p>
</p>
            </div>
          </div>      
        </article>
        <hr class="blog-seperator"/>
    </li>
  

  

  

  

  

  

  

  

  

  

  

  

</ol>
      </li>
      
    
      
    
      
      <li>
        <article id="comment-14">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/C36C14C4A21E4150189E96A871C507A3?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Pieter
                
              </div>
              <small>
                <a href="#comment-14" title="Link naar deze reactie">
                  <time>Friday 9 Jan 2015 om 12:07:06</time>
                  
                </a>
              </small>
              <p>Thanks, that makes sense. I&rsquo;ll be patience!</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

</ol>
      </li>
      
    
      
      <li>
        <article id="comment-15">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/9C2B002B0A89E0152F46283240E5F8CD?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Sijmen
                
              </div>
              <small>
                <a href="#comment-15" title="Link naar deze reactie">
                  <time>Wednesday 4 Feb 2015 om 19:50:36</time>
                  
                </a>
              </small>
              <p><p>Hi Rogier,</p>

<p>Very nice job indeed. I am also tinkering with a Software Defined Radio and an ITHO RF transmitter. No background in software or electrical engineering whatsoever. :/
My goal is to make an Arduino receiver because I have an old Itho WTW ventilation system which is not compatible with a RFT receiver.
I see I&rsquo;ve got a slightly different (programmed) ITHO transmitter, the SDR receives a signal at about 868,240000 MHz, also the number printed at top the PCB in &lsquo;7 segment display&rsquo; font is &ldquo;1033&rdquo; instead of &ldquo;1413&rdquo;.</p>

<p>It&rsquo;s the 536-0125 RFT transmitter unit: <a href="http://www.ithodaalderop.nl/sites/default/files/documents/historisch_overzicht_rf_bedieningen_ventilatie_units.pdf">http://www.ithodaalderop.nl/sites/default/files/documents/historisch_overzicht_rf_bedieningen_ventilatie_units.pdf</a></p>

<p>Soldering probe wires onto the PCB isn&rsquo;t going to do it I see. I think I&rsquo;ll buy some extra 3rd hands and use my Bus Pirate / Logic Sniffer combo to read the SPI traffic.</p>

<p>Can you share the spreadsheet with all the captured data for study?</p>

<p>With regards,</p>

<p>Sijmen</p>
</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  

  

  

  

  

  
    <li>
      <article id="comment-16">
          <div class="d-flex flex-row">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/7F2A9FD369018735070D34C0331FE9C5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Rogier Reedijk reply to Sijmen
                
              </div>
              <small>
                <a href="#comment-16" title="Link naar deze reactie">
                  <time>Thursday 5 Feb 2015 om 19:24:55</time>
                  
                </a>
              </small>
              <p><p>Hi Sijmen,</p>

<p>Nice to hear that you would also like to control the ITHO box!</p>

<p>The frequency you&rsquo;ve found is just about correct. I see that I&rsquo;ve made a mistake writing my blog above. If you look at the first table in this blogpost, on the last line you can see the frequency I&rsquo;ve calculated originally based on the SPI data: 868,299865 MHz. Further down in this post I tried to reproduce the formula I used to calculate it and made a mistake which resulted in 866,699064 MHz. So your 868,240000 MHz is very close to my correct calculation. (I will correct my blogpost as soon as possible)</p>

<p>In my first blogpost about reverse engineering the Itho remote I&rsquo;ve included a link to a blogpost from a collegue of mine, which also has the older ITHO remote: <a href="http://zigbeeme.blogspot.nl/2014/10/decoding-itho-rf-protocol.html">http://zigbeeme.blogspot.nl/2014/10/decoding-itho-rf-protocol.html</a>
He has also included some Arduino code that works on his ITHO box. So maybe, with some adjustments, it could work for you as well.</p>

<p>I&rsquo;m busy writing a follow-up post on my progress and will link to the captured data in that post.</p>

<p>If you make any progress with controlling your ITHO-box, please let me know, I would love to hear/read about problems you ran into and how you solved them.</p>

<p>Keep on reading this blog for my progress!</p>
</p>
            </div>
          </div>      
        </article>
        <hr class="blog-seperator"/>
    </li>
  

  

  

  

  

  

  

  

  

</ol>
      </li>
      
    
      
    
      
      <li>
        <article id="comment-17">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/CF8A52B00AAAFF5039DFBB43F5D09462?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Klusjesman
                
              </div>
              <small>
                <a href="#comment-17" title="Link naar deze reactie">
                  <time>Saturday 16 May 2015 om 15:38:09</time>
                  
                </a>
              </small>
              <p><p>Hi Rogier,</p>

<p>I don&rsquo;t know if you are still working on reverse engineering the RF messages?</p>

<p>Two days ago I started reverse engineering the RF messages myself. I am a software engineer (PC) and played with microcontrollers a few years ago (control stepper motor and some leds only). I have knowledge of reverse engineering in the PC field, but not on the electrical level.</p>

<p>The reason I started working on this is because Itho doesn&rsquo;t have any way to control the ventilation based on humidity. Ofcourse there are easy workaround solutions by using controlling the perilex or accessing the RF remote buttons but I don&rsquo;t like those solutions. Also it will be a fun project for me because I am new into this field.</p>

<p>I shortly investigated the possibility of extracting the firmware out of the AtMega. Probably the microcontroller is protected so I skipped this possibility.</p>

<p>So last week I ordered a crappy logic analyser on ebay. It is giving me some noise in the analyzer software from time to time. But it was only 23 euro&rsquo;s including shipment cost.</p>

<p>I almost have a clear picture of the whole messages which are being transferred. Data fields inside the messages consists of:
- info about selected modespeed
- info about previous selected mode
- 6 fields which contain numbers from fixed sequences. One sequence is influenced by the selected mode.</p>

<p>I&rsquo;ve made a small .net program which I use to predict how the next message will look like. It works nicely and matches the results from the analyser.</p>

<p>One of the 6 fields with sequence data is not completely clear to me. It depends on the selected mode but even after 1000 messages I cannot find a logic in it. My guess is there is no logic in this one and it is used to make reverse engineering more difficult. I know how the field changes based on the selected mode. In the end the number in this field is even or odd. Maybe this is the only requirement on this field (the explanation in the paragraph below supports this). I can only find out by testing with a microcontroller. (I still have to order some parts).</p>

<p>I don&rsquo;t think there is an unique id for each remote. The longest sequence of bytes used by Itho is 256 bytes long. In combination with all other sequences which are running across the different messages you will get 256 different messages. Initialisation of a new remote control by pressing two buttons for one second is probably needed so the base unit (CVE) knows which message (based on sequence) is expected next. This is just my guess. Your story about the CVE which started to work after 300 messages fits my findings. I guess there were no 300 messages transferred but only 256! The same message is repeated after 256 messages.</p>

<p>Things I have to do:
- investigate init messagetransfer
- do some more analysing on one of the 6 sequence fields
- order some RF transmitter to test (ATMega and a programmerdebugger was already ordered and is expected next week)
- write C code for the ATMega and test</p>

<p>When I am 100% certain (by testing) about all my findings then I will put them in a document and post them somewhere on a domotica forum.</p>

<p>After two CR2032 batteries which were drained empty after a few hours of analyzing I concluded the remote control stays active when there is a lot of activity on the buttons. Don&rsquo;t know if this is true. Maybe the logic analyzer itself is playing a role in this. Now I am just removing the battery when I am not analyzing.</p>

<p>If you are interested in the .net application I made then I can send it to you. The source will reveal how the sequences are calculated for the messages and how the next message can be predicted.</p>

<p>Kind regards,
Patrick</p>
</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  

  

  

  

  

  

  

  
    <li>
      <article id="comment-18">
          <div class="d-flex flex-row">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/7F2A9FD369018735070D34C0331FE9C5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Rogier Reedijk reply to Klusjesman
                
              </div>
              <small>
                <a href="#comment-18" title="Link naar deze reactie">
                  <time>Saturday 16 May 2015 om 16:27:00</time>
                  
                </a>
              </small>
              <p><p>Hey Patrick,</p>

<p>Thanks for your long and insightful comment! I would love to receive the .NET application you wrote. Can you email it to &ldquo;Rogier dot Reedijk AT gmail dot com&rdquo;? Or else create a simple GitHub repository and post a link?
I would also love to see a picture of how you connected the analyzer to the remote control. Did you also use helping hands and pins?
And if it&rsquo;s not to much trouble I would love to receive some logical analyzer capture files you made. Because with those I could find out which bytes change between different remote controls!</p>

<p>I&rsquo;m still working on reverse engineering the messages and took a big step forward this weekend. I&rsquo;ve got all 4 buttons working now and I&rsquo;m busy writing a blog post about it (should be up this weekend). The source code is already uploaded to my regular GitHub repository for this project:
<a href="https://github.com/xs4free/Itho-library">https://github.com/xs4free/Itho-library</a>
And the most recent logical analyzer files (and my own C# program) are in another repository:
<a href="https://github.com/xs4free/Itho-project">https://github.com/xs4free/Itho-project</a></p>

<p>I think that I understand most of the data that&rsquo;s being transmitted by the remote. It&rsquo;s a bit much to explain in this comment, so please read my next blog-post that should be up on this blog tomorrow.</p>

<p>My goal is almost the same as yours, I want to control the ventilation based on the humidity in my bathroom. Only, I want to keep the sensor and the ventilation control separated. So I want to create a home-automation server that reads the humidity and based on that value, changes the speed of the ventilation.</p>

<p>I also investigated extracting the firmware from the remote, but came to the same conclusion, the AT Mega is most likely protected. And that would make it nearly impossible.</p>

<p>I&rsquo;m looking forward to hearing from you! And would love to help where I can.
If you buy the same RF board (CC1150) as I have bought, than you can use my code and be up and running very quickly!</p>

<p>Kind regards, RogierR.</p>
</p>
            </div>
          </div>      
        </article>
        <hr class="blog-seperator"/>
    </li>
  

  

  

  

  

  

  

</ol>
      </li>
      
    
      
    
      
      <li>
        <article id="comment-19">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/CF8A52B00AAAFF5039DFBB43F5D09462?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Klusjesman
                
              </div>
              <small>
                <a href="#comment-19" title="Link naar deze reactie">
                  <time>Saturday 16 May 2015 om 18:02:33</time>
                  
                </a>
              </small>
              <p><p>I just mailed you all my files including a photo.</p>

<p>I soldered pins on the print so I could easily connect the analyzer. I don&rsquo;t have helping hands or a lot of tools so this was the only option for me.</p>

<p>I&rsquo;m also going to use it in my bathroom. Maybe I will connect everything to a base system, it would be nice to be able to make config changes on a touchscreen. I already did some quick research on the OpenTherm protocol because that would be the next step. I want to control humidity by the ventilation system and by controlling the temperature.</p>

<p>I assumed the reverse engineering would be the hardest part so that&rsquo;s why I started with this. If I didn;t manage to reverse engineer then I didn&rsquo;t waste much money on this project (except for the programmerdebugger board).</p>
</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  

  

  

  

  

  

  

  

  

  

  
    <li>
      <article id="comment-21">
          <div class="d-flex flex-row">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/7F2A9FD369018735070D34C0331FE9C5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Rogier Reedijk reply to Klusjesman
                
              </div>
              <small>
                <a href="#comment-21" title="Link naar deze reactie">
                  <time>Tuesday 19 May 2015 om 07:37:15</time>
                  
                </a>
              </small>
              <p><p>Thanks for the photo and the explanation! Soldering pins to the testpads seems like a very stable way to analyze the messages between the AtMega and the CC1150.</p>

<p>I have also been looking at the OpenTherm protocol and currently have all the parts to create an OpenTherm Gateway: <a href="http://otgw.tclcode.com/">http://otgw.tclcode.com/</a>
That will most likely be my next project after I create a humidity sensor for my bathroom!</p>
</p>
            </div>
          </div>      
        </article>
        <hr class="blog-seperator"/>
    </li>
  

  

  

  

</ol>
      </li>
      
    
      
      <li>
        <article id="comment-20">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/CF8A52B00AAAFF5039DFBB43F5D09462?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Klusjesman
                
              </div>
              <small>
                <a href="#comment-20" title="Link naar deze reactie">
                  <time>Sunday 17 May 2015 om 14:17:37</time>
                  
                </a>
              </small>
              <p><p>I have compared my messages with one of yours and some values are different.</p>

<p>Byte 6,7,8,13,14,15,36,39,40,41,58 (zero based index).</p>

<p>In my messages these bytes always contain the same value. So they seem to be connected to the device itself. Maybe the values are set during initialisation of the remote, maybe they are fixed.</p>

<p>If there really is some unique reference to each remote then I am wondering why the whole circus with changing sequences is used. To lower the chance of interference with other RF transmitting devices? Or only because of reverse engineering? Don&rsquo;t know if there could be other reasons.</p>

<p>I was also thinking about your message which was accepted after 300 resends. What happens when the base station misses one message from the remote? Will it be out of sync until init of the remote? or are the sequences not that critical and allow some mistakes in it? I was guessing for the last one because otherwise Itho could get a lot of complaints from customers. I just checked this point on my CVE. I unplugged the power and used the remote a couple of times. After putting back the power it still works using the remote. Also a battery change did not introduce any problem. So it allows some missing messages during transfer. It would be interesting to know how many missing messages are accepted.</p>
</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  

  

  

  

  

  

  

  

  

  

  

  
    <li>
      <article id="comment-22">
          <div class="d-flex flex-row">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/7F2A9FD369018735070D34C0331FE9C5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Rogier Reedijk reply to Klusjesman
                
              </div>
              <small>
                <a href="#comment-22" title="Link naar deze reactie">
                  <time>Tuesday 19 May 2015 om 07:51:08</time>
                  
                </a>
              </small>
              <p><p>I&rsquo;m going the take a closer look at the excelsheet you sent me.</p>

<p>Do keep in mind that the binary data you have recorded comes from 2 different messages, that are transmitted on 2 different frequencies. The first message is exactly 20 bytes long and the second message is 50 bytes plus 3 bits.</p>

<p>I do think each remote has a programmed or generated unique identifier. I don&rsquo;t know if there is any logic in the bytes for this identifier (maybe it has a checksum of some sorts). Currently I have recorded analyzer traces from 2 different remotes, so I have 2 unique identifiers. If my &ldquo;join&rdquo; command works (I need to test this) then everyone should be able to use my code and use the identifier from my remote.</p>

<p>The changes of the sequence number is used by the ventilation box to determine if you have pressed the same button multiple times. This is needed for the timer button, because if you press it once the box will run at full speed for 10 minutes, if you press the timer button twice the box will run for 20 minutes, and so on. If the RF message would not contain a sequence number, the ventilation box would not be able to distinguish between receiving the same message multiple times and receiving a second button press.</p>

<p>Thanks for testing what happens when you press the remote buttons without the box being powered on! I hadn&rsquo;t gotten around to testing that yet.</p>

<p>I have been testing my code for one evening now and it is working perfectly. In code I&rsquo;m using the same identifier as the physical remote and both remotes work fine at every button press. So the ventilation box isn&rsquo;t checking that the sequence numbers are increasing/decreasing. This leads me to believe that my current code is overly complicated (i&rsquo;m keeping track of my previous buttons press and 2 counters in the Arduino). If I find some time, I&rsquo;ll experiment some more with the code and see if the code works with a fixed number.</p>

<p>Please read the last blogpost I added today and let me know what you think!</p>
</p>
            </div>
          </div>      
        </article>
        <hr class="blog-seperator"/>
    </li>
  

  

  

</ol>
      </li>
      
    
      
    
      
    
      
      <li>
        <article id="comment-23">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/733A0427DAFF5491F9D41EA9A7661198?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Marco van &#39;t Slot
                
              </div>
              <small>
                <a href="#comment-23" title="Link naar deze reactie">
                  <time>Friday 13 Nov 2015 om 21:57:04</time>
                  
                </a>
              </small>
              <p><p>Hi Rogier and Klusjesman,</p>

<p>Great reading your blogs about the investigation on the ITHO system. I have a similar system in my house installed and am very interested in your final results. Were you able to complete it, and control the system by your own remote / domonica?</p>

<p>Thanks. Marco</p>
</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    <li>
      <article id="comment-24">
          <div class="d-flex flex-row">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/7F2A9FD369018735070D34C0331FE9C5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Rogier Reedijk reply to Marco van &#39;t Slot
                
              </div>
              <small>
                <a href="#comment-24" title="Link naar deze reactie">
                  <time>Friday 13 Nov 2015 om 23:31:16</time>
                  
                </a>
              </small>
              <p>Hi Marco,
If you read my last post, <a href="http://www.progz.nl/blog/index.php/2015/05/reverse-engineering-remote-itho-cve-eco-rft-part-6/">http://www.progz.nl/blog/index.php/2015/05/reverse-engineering-remote-itho-cve-eco-rft-part-6/</a> , you can read how far I got. I haven&rsquo;t integrated my controller into a home automation system yet, but I am able to control the Itho ventilation box.
Currently I&rsquo;m very busy packing, because I&rsquo;m moving to a new home within a few weeks. The new home currently does not have an Itho box, but does need a new ventilation system. So as soon as I am settled in, and have replaced the box by an Itho, then I will try and integrate it into a home automation system.
What system are you using? Or what system do you like?</p>
            </div>
          </div>      
        </article>
        <hr class="blog-seperator"/>
    </li>
  

</ol>
      </li>
      
    
      
    
    </ol>
  

  
</section>
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
