<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.51" />

    
    
    

<title>Reverse engineering remote Itho CVE ECO RFT – Part 4 • Rogier&#39;s blog</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reverse engineering remote Itho CVE ECO RFT – Part 4"/>
<meta name="twitter:description" content="Reading back my previous blogpost I noticed that it has been a month since my last post! This doesn&rsquo;t mean the project has stopped or that I&rsquo;ve lost interest, it just means there is a lot happening in my life and it&rsquo;s hard for me to find some spare time to do the work needed to advance this project.
I ended my previous post (part 3) with &ldquo;let&rsquo;s write some code&rdquo;."/>

<meta property="og:title" content="Reverse engineering remote Itho CVE ECO RFT – Part 4" />
<meta property="og:description" content="Reading back my previous blogpost I noticed that it has been a month since my last post! This doesn&rsquo;t mean the project has stopped or that I&rsquo;ve lost interest, it just means there is a lot happening in my life and it&rsquo;s hard for me to find some spare time to do the work needed to advance this project.
I ended my previous post (part 3) with &ldquo;let&rsquo;s write some code&rdquo;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.progz.nl/blog/2015/02/05/reverse-engineering-remote-itho-cve-eco-rft-part-4/" /><meta property="article:published_time" content="2015-02-05T23:14:48&#43;01:00"/>
<meta property="article:modified_time" content="2015-02-05T23:14:48&#43;01:00"/>


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/blog/scss/hyde-hyde.173e0dc3bb8c6a72b7f6415bdbae34b6521efd304b087c69ab48bddcf583090a.css" integrity="sha256-Fz4Nw7uManK39kFb2640tlIe/TBLCHxpq0i93PWDCQo=">


<link rel="stylesheet" href="/blog/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>


    <body class="theme-progz ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.progz.nl/blog">Rogier&#39;s blog</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://www.progz.nl/blog/img/Rogier-Reedijk.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Rogier&#39;s blog</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/blog/about/">
						<span>About</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/xs4free" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://facebook.com/rogier.reedijk" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/xs4free" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://linkedin.com/in/rogierreedijk" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2018 Rogier Reedijk
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>Reverse engineering remote Itho CVE ECO RFT – Part 4</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 5, 2015
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/blog/categories/homeautomation">HOMEAUTOMATION</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/blog/tags/arduino">arduino</a>
           
      
          <a class="badge badge-tag" href="/blog/tags/cc1150">cc1150</a>
           
      
          <a class="badge badge-tag" href="/blog/tags/itho">itho</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 6 min read
</div>


  </header>
  
  
  <div class="post">
    <p>Reading back my previous blogpost I noticed that it has been a month since my last post! This doesn&rsquo;t mean the project has stopped or that I&rsquo;ve lost interest, it just means there is a lot happening in my life and it&rsquo;s hard for me to find some spare time to do the work needed to advance this project.</p>

<p>I ended my previous post (<a href="https://www.progz.nl/blog/2015/01/reverse-engineering-remote-itho-cve-eco-rft-part-3/" title="Reverse engineering remote Itho CVE ECO RFT – Part 3">part 3</a>) with &ldquo;let&rsquo;s write some code&rdquo;. What it should have read was &ldquo;let&rsquo;s connect the CC1101 to my Arduino&rdquo;. This sound relatively easy, but it’s a step I really underestimated.</p>



<figure class="no-photoswipe">
    <img src="/blog/2015/02/05/reverse-engineering-remote-itho-cve-eco-rft-part-4/ArduinoNano_hu7a797ad8820323139cbf0b5bbc7becb7_67113_750x750_fit_q75_box.jpg" alt="ArduinoNano" class="img-fluid" />
	
</figure>

<p>The plan was to connect a <a href="http://r.ebay.com/Pk9ImK">CC1101 board</a> I had bought on eBay and connect it to an <a href="http://arduino.cc/en/Main/ArduinoBoardNano">Arduino Nano</a> (also bought on eBay). I choose the Arduino Nano because it has an USB-connector on the board and that makes it easier to connect it to my pc and to my future IoT-hub (more on that in future posts).</p>



<figure class="no-photoswipe">
    <img src="/blog/2015/02/05/reverse-engineering-remote-itho-cve-eco-rft-part-4/CC1101-board_hub03bb78674a4be7b5025ae330f8be3b9_32673_750x750_fit_q75_box.jpg" alt="CC1101-board" class="img-fluid" />
	
</figure>

<p>The CC1101 board I ordered has 8 pins:</p>

<ol>
<li>GND</li>
<li>VCC</li>
<li>GDO0</li>
<li>CSN</li>
<li>SCK</li>
<li>MOSI</li>
<li>MISO/GDO1</li>
<li>GDO2</li>
</ol>

<p>The datasheet on eBay said the board supports a VCC voltage ranging from 1.8 to 3.6VDC. Since the Arduino Nano has a 3V3 output that connection was a no-brainer. The GND is also directly available on the Arduino Nano, no problem. Next were the SPI pins: CSN, SCK, MOSI and MISO. Turns out the Nano has dedicated pins for SPI: SS (CSN) on pin 10, SCK on pin 13, MOSI on pin 11, MISO on pin 12. Sounds simple, right? The only pins that are left to connect are GDO0 and GDO2. I choose pin 2 and pin 9, because that’s what the <a href="https://github.com/panStamp/panstamp/wiki/panStamp%20AVR.-Technical%20details">panStamp</a> <a href="https://github.com/panStamp/panstamp">library</a> seems to be using, and it’s almost the same combination I’m using (Arduino 328p with CC1101).</p>

<p>This is when I made my first and most crucial mistake, I got so excited that I found the panStamp library and that I had decoded enough data in my previous blogposts, that I had to try out the panStamp code. In my enthusiasm I forgot to double check everything and went ahead and turned on the Arduino Nano (connected to the CC1101) and programmed the code. After a few tweaks, the code that I wrote using the library ran, but I didn’t see the values I was expecting on my logical analyzer. That was the point where I should have realized there was something wrong, but instead I assumed that I had made a mistake in the code and started debugging. I first made the code smaller (fewer statements) so that I could focus on a few commands between the Arduino Nano and the CC1101. Every command send to the CC1101 should be acknowledged by the CC1101 and there are also commands to read back register settings from the CC1101. I thought that I would start by reading back the default values from the registers of the CC1101 after a hard reset, because then I could verify that my code was working. No matter what I tried the CC1101 didn’t return the values I was expecting. So I started using other libraries (the <a href="https://code.google.com/p/rfbee/source/browse/branches/#branches%2Fv2.0%2FRFBee">RFbee library</a> is very nice and very well documented). When this library also failed to read the values I was expecting, I created a SPI library (set of methods) from scratch, even skipping the SPI functions the standard Arduino library provides. I bit-banged out the appropriate commands and still the CC1101 refused to return the defaults values.</p>

<p>I think at this point I had spent about 5 evenings &amp; nights writing code and switching between different Arduino’s, when I started suspecting the CC1101 was the problem. I opened up the <a href="http://www.ti.com/lit/ds/symlink/cc1101.pdf">datasheet for the CC1101</a> and started reading it from the top. When I got to chapter 1 “Absolute Maximum Ratings” (page 8 of the PDF) I noticed something: “Voltage on any digital pin” “max” “3.9”. I know that I have connected the VCC of the CC1101 to the 3.3v connection of the Arduino, but how much voltage do the other pins of the Arduino Nano supply? From the Arduino website: “Each of the 14 digital pins on the Nano can be used as an input or output, using pinMode(), digitalWrite(), and digitalRead() functions. They operate at <strong>5</strong> volts.” Ouch! That means I have blown my CC1101 on the first power-up and just spend 5 evenings &amp; nights searching for a bug in the code that wasn’t there.</p>

<p>There was nothing more I could do at this moment, but order another CC1101 chipset on eBay and wait. The next day I told this story to a colleague of mine and he pointed out another mistake I made. I bought a CC1101 board, but did not check what the other components on the board did. Turns out the components used on the board made an passive filter between the antenna and the CC1101, limiting/optimizing the signal to a frequency off 433MHz. Since I need 868 MHz, this board (and the one I just ordered) would probably have never worked on the Itho ventilation box.</p>

<p>I started searching for another CC1101 of CC1150 board which does support 868MHz. This is very hard/impossible to find on eBay. All manufacturers seem to optimize their boards for 433MHz. My colleague suggested I try out the <a href="http://www.hoperf.com/upload/rfchip/RF69-V1.2.pdf">Hope RF69 chips</a>. These are very popular chips, since <a href="http://lowpowerlab.com/moteino/">Moteino</a> and <a href="http://jeelabs.org/">JeeLabs</a> both are using this (and similar chips). So I ordered a few (4) chips from a Dutch supplier and I am now waiting for the 2mm pin headers from China to solder wires to these chips.</p>

<p>Lessons learned from all this:</p>

<ol>
<li>Read the datasheet before you connect anything! Not all chips can handle more than 3.3V on their input.</li>
<li>Carefully select the RF transmitter you need. Each board is usually optimized for a specific frequency.</li>
<li>Not all RF transmitters use the same commands/registers, not even the ones from the same manufacturer. Again, read the datasheet!</li>
<li>Order at least 1 component more than you need, so you can check/swap them if one is broken/blown.</li>
</ol>

<p>Ps. Several people have asked me to share the traces from the logical analyzer I captured. I have put all files on <a href="https://github.com/xs4free/Itho-library/tree/master/Logical-Analyzer-traces">my GitHub repository</a>.
The <code>*.logicdata</code> files can be opened with the free <a href="https://www.saleae.com/downloads">Salaea Logic software</a>. The <code>*.csv</code> files contain extracts of the <code>*.logicdata</code> files. The <code>*.xlsx</code> files combine all extracts and add references to the datasheet. Not all commands contain xlsx-files yet, I’m currently focusing on the ‘full’-command. Please let me know if you find these files usefull and/or want to automate the Itho yourself!</p>

<p><strong>Other posts in this serie:</strong> <a href="http://www.progz.nl/blog/index.php/2014/12/reverse-engineering-remote-itho-cve-eco-rft-part-1/" title="Reverse engineering remote Itho CVE ECO RFT – Part 1">part 1</a>, <a href="http://www.progz.nl/blog/index.php/2014/12/reverse-engineering-remote-itho-cve-eco-rft-part-2/" title="Reverse engineering remote Itho CVE ECO RFT – Part 2">part 2</a>, <a href="http://www.progz.nl/blog/index.php/2015/01/reverse-engineering-remote-itho-cve-eco-rft-part-3/" title="Reverse engineering remote Itho CVE ECO RFT – Part 3">part 3</a>, <a href="http://www.progz.nl/blog/index.php/2015/02/reverse-engineering-remote-itho-cve-eco-rft-part-5/" title="Reverse engineering remote Itho CVE ECO RFT – Part 5">part 5</a>, <a href="http://www.progz.nl/blog/index.php/2015/05/reverse-engineering-remote-itho-cve-eco-rft-part-6/">Part 6</a></p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="https://www.progz.nl/blog/2015/02/18/reverse-engineering-remote-itho-cve-eco-rft-part-5/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Reverse engineering remote Itho CVE ECO RFT – Part 5</span>
    </a>
    
    
    <a href="https://www.progz.nl/blog/2015/01/04/reverse-engineering-remote-itho-cve-eco-rft-part-3/" class="navigation-next">
      <span class="navigation-tittle">Reverse engineering remote Itho CVE ECO RFT – Part 3</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <section class="comments-area">
  <a id="comments"></a>

  
  

  
    
  

  
  
    
         

    
    <h3><i class="fas fa-comment-alt"></i> 1 replies on “Reverse engineering remote Itho CVE ECO RFT – Part 4”</h3>

    <ol>
    
      
      <li>
        <article id="comment-26">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/A0D08E9062F0B03F4749664738388DE5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                obiwanjacobi
                
              </div>
              <small>
                <a href="#comment-26" title="Link naar deze reactie">
                  <time>Friday 6 Feb 2015 om 17:40:06</time>
                  
                </a>
              </small>
              <p>Yes, indeed it all starts with the datasheet. I have a dark molten patch on one of my breadboards to remind me. There is also a trap in buying doubles, if it does work in one go you are left with spare parts you will probably not use again. Anyway I think you are doing great.</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

</ol>
      </li>
      
    
    </ol>
  

  
</section>
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
