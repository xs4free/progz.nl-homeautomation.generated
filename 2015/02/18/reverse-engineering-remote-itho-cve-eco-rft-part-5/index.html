<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.51" />

    
    
    

<title>Reverse engineering remote Itho CVE ECO RFT – Part 5 • Rogier&#39;s blog</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reverse engineering remote Itho CVE ECO RFT – Part 5"/>
<meta name="twitter:description" content="Two steps forward and one step back (almost like the song). That&rsquo;s what my progress with reverse engineering the Itho RFT remote feels like. I&rsquo;ve made some good progress in sending out the RF signal, but the ventilation box isn&rsquo;t responding. The signal is more complex than I expected.
The first big step forward, since my last blog post was made because I (finally) received the CC1150 board I ordered on eBay."/>

<meta property="og:title" content="Reverse engineering remote Itho CVE ECO RFT – Part 5" />
<meta property="og:description" content="Two steps forward and one step back (almost like the song). That&rsquo;s what my progress with reverse engineering the Itho RFT remote feels like. I&rsquo;ve made some good progress in sending out the RF signal, but the ventilation box isn&rsquo;t responding. The signal is more complex than I expected.
The first big step forward, since my last blog post was made because I (finally) received the CC1150 board I ordered on eBay." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.progz.nl/blog/2015/02/18/reverse-engineering-remote-itho-cve-eco-rft-part-5/" /><meta property="article:published_time" content="2015-02-18T21:20:31&#43;01:00"/>
<meta property="article:modified_time" content="2015-02-18T21:20:31&#43;01:00"/>


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/blog/scss/hyde-hyde.173e0dc3bb8c6a72b7f6415bdbae34b6521efd304b087c69ab48bddcf583090a.css" integrity="sha256-Fz4Nw7uManK39kFb2640tlIe/TBLCHxpq0i93PWDCQo=">


<link rel="stylesheet" href="/blog/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>


    <body class="theme-progz ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.progz.nl/blog">Rogier&#39;s blog</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://www.progz.nl/blog/img/Rogier-Reedijk.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Rogier&#39;s blog</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/blog/about/">
						<span>About</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/xs4free" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://facebook.com/rogier.reedijk" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/xs4free" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://linkedin.com/in/rogierreedijk" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 Rogier Reedijk
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>Reverse engineering remote Itho CVE ECO RFT – Part 5</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 18, 2015
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/blog/categories/homeautomation">HOMEAUTOMATION</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/blog/tags/arduino">arduino</a>
           
      
          <a class="badge badge-tag" href="/blog/tags/cc1150">cc1150</a>
           
      
          <a class="badge badge-tag" href="/blog/tags/itho">itho</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 10 min read
</div>


  </header>
  
  
  <div class="post">
    <p>Two steps forward and one step back (almost like the song). That&rsquo;s what my progress with reverse engineering the Itho RFT remote feels like. I&rsquo;ve made some good progress in sending out the RF signal, but the ventilation box isn&rsquo;t responding. The signal is more complex than I expected.</p>

<p>The first big step forward, since my last blog post was made because I (finally) received the CC1150 board I ordered on eBay. This is almost a drop-in replacement for the CC1101 board I blew up by applying to much voltage to it&rsquo;s pins, and is actually the same chipset as the Itho remote uses. So the traces I recorded using the logical analyzer should be replay-able bit-by-bit.</p>



<figure class="no-photoswipe">
    <img src="/blog/2015/02/18/reverse-engineering-remote-itho-cve-eco-rft-part-5/CC1150_hu69f992c48cce98173c90c34caf923ba8_76854_750x750_fit_q75_box.jpg" alt="CC1150" class="img-fluid" />
	
</figure>

<p>First I connected the board to my Arduino Pro Mini (clone) running at 3.3 volt (I&rsquo;m not taking any changes with this board). Then I modified (slimmed down) the code I used during my previous test, so I could just read some default values from the CC1150-registers. I used the Arduino SPI library (not my own bit-banging code) and it worked the first time around! I could read the PARTNUM (default value 2), VERSION (default value 4) and FREQuency (default values 0x1E 0xC4 0xEC). Hurray! Now we are getting somewhere. (my code is on my GitHub repository, in the <a href="https://github.com/xs4free/Itho-library/blob/master/examples/ReadRegisters/ReadRegisters.ino">ReadRegisters example</a> for the Itho-library I&rsquo;m creating)</p>

<p>The next logical step was to set all recorded registers and sent the parallel data to see if the Ihto would change it&rsquo;s speed. Adding the code to set the registers was easy, but the code that sends the parallel data proved to be more difficult. This code has to listen to a clock signal that the CC1150 is generating, and on each rising edge of that signal another pin should be set high or low to clock out the (parallel) data. This sounds pretty easy, but is actually harder than I expected, especially when you have to do it at pretty high speeds and with precision timing. I ended up writing 4 versions of the same code, where only one actually worked.</p>

<p><a href="https://github.com/xs4free/Itho-library/blob/master/not-working-examples/Version1_PinchangeInt/Version1_PinchangeInt.ino">Version 1</a> used an Arduino library named <a href="http://playground.arduino.cc/Main/PinChangeInt">PinchangeInt</a> to listen to the falling edge of the clock-signal (on the Miso-pin) and then set the GDO1-pin in the right state. This version of the code is the cleanest solution and leaves the reading of the clock-signal to the hardware interrupt handler of the Arduino (actually the ATMEGA chip to be more precise). The problem with this code was that the Interrupt Service Routine was called again, before the previous call had finished setting the GDO1-pin. In the logical analyzer I could see that this resulted in incorrect data being transmitted to the CC1150 and thus to the Itho ventilation box.</p>

<pre><code>void ISR_MISO() {
  // check if there is any more data to send
  if (dataIndexBits &lt; dataLengthBits) { 

    byte bufferValue = dataBuffer[bufferIndex];

    if (bufferValue &amp; mask) {
      digitalWrite(GDO0, HIGH);
    }
    else {
      digitalWrite(GDO0, LOW);
    }

    // bitmask trick came from: http://arduino.cc/en/Tutorial/BitMask
    mask &gt;&gt;= 1;

    if (mask == 0)
    {
      mask = 10000000; //reset mask
      bufferIndex++; //goto next byte in the data-array
    }

    dataIndexBits++; //increase bits send
  }
}

void enableMisoInterrupt() {
  pinMode(GDO0, OUTPUT); // sets the digital pin as output

  //queue the first bit, because the code below waits
  //for the first RISING edge to queue the next
  ISR_MISO(); 

  PCintPort::attachInterrupt(SPI_MISO, &amp;ISR_MISO, FALLING);
}
</code></pre>

<p><a href="https://github.com/xs4free/Itho-library/blob/master/not-working-examples/Version2_TimerOne/Version2_TimerOne.ino">Version 2</a> of the code did not rely on hardware interrupts but instead tried to clock out the signal at the exact time the CC1150 was expecting it (this is called Asynchronous transparent mode in the CC1150 datasheet). This meant that I would have to clock out data at exactly 38.46kHz, or one bit every 26 microseconds. For this the Arduino/ATMEGA has a feature called a timer. This is a hardware feature that you can configure to generate a signal every specified time. I used the clean Arduino <a href="https://github.com/PaulStoffregen/TimerOne">library TimerOne</a> from Paul Stoffregen to configure the timer. The timer fired, but not at the speed I configured, the fastest time it fired was every 90 microseconds. I think this isn&rsquo;t a problem with the library but rather a limitation of the Arduino Pro Mini (running at 8 MHz) and not processing the timer-interrupts fast enough.</p>

<pre><code>void enableMisoInterrupt() {
  pinMode(GDO0, OUTPUT); // sets the digital pin as output

  timerOne.initialize(26); //26 us = 38.46 kHz
  timerOne.attachInterrupt(ISR_MISO);
}
</code></pre>

<p><a href="https://github.com/xs4free/Itho-library/blob/master/not-working-examples/Version3_SynchronousSerialSlow/Version3_SynchronousSerialSlow.ino">Version 3</a> of the code used the Synchronous Serial Operation mode of the CC1150 (just like version 1) but instead of using an interrupt to listen to the clock-signal I used an endless loop to read the value of the clock. This way I can detect the clock signal switching from low to high, which means the rising edge has taken place. After each rising edge (at which the CC1150 reads the data), I could change the output pin to the next value and wait for the next rising edge to pass. With this code I came a lot closer to the maximum of 26 microseconds that I had, but still not close enough (it was still over 50 microseconds).</p>

<pre><code>void enableMisoInterrupt() {
  pinMode(GDO0, OUTPUT); // sets the digital pin as output

  generateFakeInterrupts();
}

void generateFakeInterrupts() {
  int previousMiso = -1;
  int currentMiso = -1;

  noInterrupts();

  //queue the first bit, because the code below waits
  //for the first RISING edge to queue the next
  ISR_MISO(); 

  do
  {
    currentMiso = digitalRead(SPI_MISO);

    if (currentMiso != previousMiso)
    {
      //wait for Miso to be high, then the RISING edge has taken place
      //and we can clock in new data
      if (currentMiso == HIGH)
      {
        ISR_MISO();
      }
      previousMiso = currentMiso;
    }
  }
  while(dataIndexBits &lt; dataLengthBits);

  // wait for the last clock to become high
  // so the last queued bit is also sent
  while(digitalRead(SPI_MISO) == LOW);

  interrupts();
}
</code></pre>

<p>In <a href="https://github.com/xs4free/Itho-library/blob/master/not-working-examples/Version4_SynchronousSerialFast/Version4_SynchronousSerialFast.ino">version 4</a> the only thing I changed where the calls for digitalRead and digitalWrite. I switch them for calls to digitalReadFast and digitalWriteFast in the <a href="https://code.google.com/p/digitalwritefast/">DigitalWriteFast-library</a>. This sped up the code considerably, and I was actually able to respond within the required 26 microseconds.</p>

<pre><code>void generateFakeInterrupts() {
  int previousMiso = -1;
  int currentMiso = -1;

  noInterrupts();

  //queue the first bit, because the code below waits
  //for the first RISING edge to queue the next
  ISR_MISO();

  do
  {
    currentMiso = digitalReadFast2(SPI_MISO);

    if (currentMiso != previousMiso)
    {
      //wait for Miso to be high, then the RISING edge has taken place
      //and we can clock in new data
      if (currentMiso == HIGH)
      {
        ISR_MISO();
      }
      previousMiso = currentMiso;
    }
  }
  while(dataIndexBits &lt; dataLengthBits);

  // wait for the last clock to become high
  // so the last queued bit is also sent
  while(digitalReadFast2(SPI_MISO) == LOW);

  interrupts();
}
</code></pre>

<p>Using version 4 of the code (and some extra tweaks here and there), the logical analyzer finally showed the exact same commands being send to the CC1150 as I recorded previously from the remote control. But still the Itho ventilation box did not change it&rsquo;s speed&hellip;
While I was looking at my code I left the Arduino running and transmitting a full-button-press every 5 seconds. After about 15 minutes all of the sudden I could hear the Itho ventilation box changing to full speed! Hurray! I must be on the right track, the code does actually do something, only transmitting the same signal over 300 times (20 times a minute for 15 minutes) to change the speed once isn&rsquo;t exactly &lsquo;working as expected&rsquo;.</p>

<p>I started analyzing my previous recorded traces again and spotted a few bits that differ between trace v1 and trace v2 of the same button press (full speed). So this is the challenge I&rsquo;m currently facing. I hooked up the logical analyzer to the remote control again and have recorded <a href="https://github.com/xs4free/Itho-library/tree/master/Logical-Analyzer-traces/decode-sequencenumber">8 new traces</a> of the same button press (full speed). This shows that for the first serial transmission (part 1) only the last 2 bytes change of the 20 bytes sent (see <a href="https://github.com/xs4free/Itho-library/raw/master/Logical-Analyzer-traces/decode-sequencenumber/decode-sequencenumber.xlsx">Excel compare sheet</a>).</p>

<table>
<thead>
<tr>
<th>v1</th>
<th>v2</th>
</tr>
</thead>

<tbody>
<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>173</td>
<td>173</td>
</tr>

<tr>
<td>51</td>
<td>51</td>
</tr>

<tr>
<td>83</td>
<td>83</td>
</tr>

<tr>
<td>74</td>
<td>74</td>
</tr>

<tr>
<td>203</td>
<td>203</td>
</tr>

<tr>
<td>76</td>
<td>76</td>
</tr>

<tr>
<td>205</td>
<td>205</td>
</tr>

<tr>
<td>84</td>
<td>84</td>
</tr>

<tr>
<td>213</td>
<td>213</td>
</tr>

<tr>
<td>85</td>
<td>85</td>
</tr>

<tr>
<td>51</td>
<td>51</td>
</tr>

<tr>
<td>82</td>
<td>82</td>
</tr>

<tr>
<td>180</td>
<td>180</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>171</td>
<td>171</td>
</tr>

<tr>
<td><span style="background-color:#fff700">85</span></td>
<td><span style="background-color:#fff700">77</span></td>
</tr>

<tr>
<td>75</td>
<td>77</td>
</tr>
</tbody>
</table>

<p>And for the second serial transmission (still the same button press), a total of 5 bytes change (of the 50 bytes sent):</p>

<table>
<thead>
<tr>
<th>v1</th>
<th>v2</th>
</tr>
</thead>

<tbody>
<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>171</td>
<td>171</td>
</tr>

<tr>
<td>254</td>
<td>254</td>
</tr>

<tr>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>179</td>
<td>179</td>
</tr>

<tr>
<td>42</td>
<td>42</td>
</tr>

<tr>
<td>171</td>
<td>171</td>
</tr>

<tr>
<td>42</td>
<td>42</td>
</tr>

<tr>
<td>149</td>
<td>149</td>
</tr>

<tr>
<td>154</td>
<td>154</td>
</tr>

<tr>
<td>102</td>
<td>102</td>
</tr>

<tr>
<td>89</td>
<td>89</td>
</tr>

<tr>
<td>154</td>
<td>154</td>
</tr>

<tr>
<td>165</td>
<td>165</td>
</tr>

<tr>
<td>169</td>
<td>169</td>
</tr>

<tr>
<td>169</td>
<td>169</td>
</tr>

<tr>
<td>154</td>
<td>154</td>
</tr>

<tr>
<td>86</td>
<td>86</td>
</tr>

<tr>
<td>149</td>
<td>89</td>
</tr>

<tr>
<td>165</td>
<td>169</td>
</tr>

<tr>
<td><span style="background-color: #fff700">166</span></td>
<td><span style="background-color: #fff700">102</span></td>
</tr>

<tr>
<td>89</td>
<td>89</td>
</tr>

<tr>
<td>150</td>
<td>150</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>165</td>
<td>165</td>
</tr>

<tr>
<td>101</td>
<td>101</td>
</tr>

<tr>
<td>90</td>
<td>90</td>
</tr>

<tr>
<td>150</td>
<td>150</td>
</tr>

<tr>
<td>85</td>
<td>85</td>
</tr>

<tr>
<td>149</td>
<td>149</td>
</tr>

<tr>
<td>101</td>
<td>101</td>
</tr>

<tr>
<td>89</td>
<td>89</td>
</tr>

<tr>
<td>102</td>
<td>102</td>
</tr>

<tr>
<td>85</td>
<td>85</td>
</tr>

<tr>
<td>150</td>
<td>150</td>
</tr>

<tr>
<td>106</td>
<td>105</td>
</tr>

<tr>
<td><span style="background-color: #fff700">170</span></td>
<td><span style="background-color: #fff700">170</span></td>
</tr>

<tr>
<td>106</td>
<td>150</td>
</tr>

<tr>
<td>172</td>
<td>172</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
</tr>
</tbody>
</table>

<p>My first thought went out to a checksum, but the other bytes aren&rsquo;t changing, so a checksum should not change either. Since the CC1150 is only a transmitter it can&rsquo;t be responding to messages from the ventilation box. The only possibility that I see is that the remote stores a follow-up number in it&rsquo;s EEPROM and increments this. I would have expected the numbers to change every button press, but this is where it starts to get weird. The first 8 button presses I recorded (v5 - v12) contain the same values, but the last 2 buttons presses show a different number (for part 1). It isn&rsquo;t a simple 1 or 10 increment, so what logic is the remote using for these bytes?</p>

<table>
<thead>
<tr>
<th>v5</th>
<th>v6</th>
<th>v7</th>
<th>v8</th>
<th>v9</th>
<th>v10</th>
<th>v11</th>
<th>v12</th>
<th>v13</th>
<th>v14</th>
</tr>
</thead>

<tbody>
<tr>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>173</td>
<td>173</td>
<td>173</td>
<td>173</td>
<td>173</td>
<td>173</td>
<td>173</td>
<td>173</td>
<td>173</td>
<td>173</td>
</tr>

<tr>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
</tr>

<tr>
<td>83</td>
<td>83</td>
<td>83</td>
<td>83</td>
<td>83</td>
<td>83</td>
<td>83</td>
<td>83</td>
<td>83</td>
<td>83</td>
</tr>

<tr>
<td>74</td>
<td>74</td>
<td>74</td>
<td>74</td>
<td>74</td>
<td>74</td>
<td>74</td>
<td>74</td>
<td>74</td>
<td>74</td>
</tr>

<tr>
<td>203</td>
<td>203</td>
<td>203</td>
<td>203</td>
<td>203</td>
<td>203</td>
<td>203</td>
<td>203</td>
<td>203</td>
<td>203</td>
</tr>

<tr>
<td>76</td>
<td>76</td>
<td>76</td>
<td>76</td>
<td>76</td>
<td>76</td>
<td>76</td>
<td>76</td>
<td>76</td>
<td>76</td>
</tr>

<tr>
<td>205</td>
<td>205</td>
<td>205</td>
<td>205</td>
<td>205</td>
<td>205</td>
<td>205</td>
<td>205</td>
<td>205</td>
<td>205</td>
</tr>

<tr>
<td>84</td>
<td>84</td>
<td>84</td>
<td>84</td>
<td>84</td>
<td>84</td>
<td>84</td>
<td>84</td>
<td>84</td>
<td>84</td>
</tr>

<tr>
<td>213</td>
<td>213</td>
<td>213</td>
<td>213</td>
<td>213</td>
<td>213</td>
<td>213</td>
<td>213</td>
<td>213</td>
<td>213</td>
</tr>

<tr>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
</tr>

<tr>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>51</td>
<td>75</td>
<td>75</td>
<td>51</td>
</tr>

<tr>
<td>82</td>
<td>82</td>
<td>82</td>
<td>82</td>
<td>82</td>
<td>82</td>
<td>82</td>
<td>76</td>
<td>76</td>
<td>82</td>
</tr>

<tr>
<td>180</td>
<td>180</td>
<td>180</td>
<td>180</td>
<td>180</td>
<td>180</td>
<td>180</td>
<td>180</td>
<td>180</td>
<td>180</td>
</tr>

<tr>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
<td>170</td>
</tr>

<tr>
<td>171</td>
<td>171</td>
<td>171</td>
<td>171</td>
<td>171</td>
<td>171</td>
<td>171</td>
<td>171</td>
<td>171</td>
<td>171</td>
</tr>

<tr>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
<td>85</td>
</tr>

<tr>
<td>53</td>
<td>53</td>
<td>53</td>
<td>53</td>
<td>53</td>
<td>53</td>
<td>53</td>
<td>53</td>
<td>75</td>
<td>75</td>
</tr>
</tbody>
</table>

<p>I am going to analyze <a href="https://github.com/xs4free/Itho-library/tree/master/Logical-Analyzer-traces/decode-sequencenumber-large">a bigger set of traces</a> that I recorded for the same button press (full speed). Maybe with more data I can see the logic behind the few bytes that are changing.</p>

<p>Lessons learned:</p>

<ol>
<li>Interrupts can come too fast for a library/microcontroller to handle</li>
<li>Direct port bit changes are faster than using Arduino&rsquo;s DigitalWrite function</li>
<li>Exact timing (microsecond precision) is hard (if not impossible on a Arduino)</li>
<li>Serial communication is nice for debugging, but can screw up your timing when added in the wrong places</li>
<li>Chinese probes aren&rsquo;t that bendable (wire broke off at solder joint; fixed with my soldering iron)</li>
<li>Cleaning up 4 versions of code (for commiting to GitHub) takes more time than creating them!</li>
</ol>

<p><strong>Other posts in this serie:</strong> <a href="https://www.progz.nl/blog/2014/12/reverse-engineering-remote-itho-cve-eco-rft-part-1/" title="Reverse engineering remote Itho CVE ECO RFT – Part 1">Part 1</a>, <a href="https://www.progz.nl/blog/2014/12/reverse-engineering-remote-itho-cve-eco-rft-part-2/" title="Reverse engineering remote Itho CVE ECO RFT – Part 2">Part 2</a>, <a href="https://www.progz.nl/blog/2015/01/reverse-engineering-remote-itho-cve-eco-rft-part-3/" title="Reverse engineering remote Itho CVE ECO RFT – Part 3">Part 3</a>, <a href="https://www.progz.nl/blog/2015/02/reverse-engineering-remote-itho-cve-eco-rft-part-4/" title="Reverse engineering remote Itho CVE ECO RFT – Part 4">Part 4</a>, <a href="https://www.progz.nl/blog/2015/05/reverse-engineering-remote-itho-cve-eco-rft-part-6/">Part 6</a></p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="https://www.progz.nl/blog/2015/05/19/reverse-engineering-remote-itho-cve-eco-rft-part-6/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Reverse engineering remote Itho CVE ECO RFT – Part 6</span>
    </a>
    
    
    <a href="https://www.progz.nl/blog/2015/02/05/reverse-engineering-remote-itho-cve-eco-rft-part-4/" class="navigation-next">
      <span class="navigation-tittle">Reverse engineering remote Itho CVE ECO RFT – Part 4</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <section class="comments-area">
  <a id="comments"></a>

  
  

  
    
  

  
  
    
  
    
  
    
         

    
    <h3><i class="fas fa-comment-alt"></i> 3 replies on “Reverse engineering remote Itho CVE ECO RFT – Part 5”</h3>

    <ol>
    
      
      <li>
        <article id="comment-27">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/A0D08E9062F0B03F4749664738388DE5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                marcjacobi
                
              </div>
              <small>
                <a href="#comment-27" title="Link naar deze reactie">
                  <time>Thursday 19 Feb 2015 om 07:47:06</time>
                  
                </a>
              </small>
              <p><p>The code library that comes with the Arduino (platform) is very safe and easy to use. The price you pay is speed. It kills it. These APIs are meant for rapid prototyping and for lowering the learning curve.
Once you have a clear understanding of what you need to do (I think you do already) you could consider moving to AVR-Studio 6 (free) or writing it in assembly (never done that myself). These options will give you better performance and more control (and more things to manage).</p>

<p>I wonder what happens when you use version 1 of your code (interrupts) with the fast write functions&hellip;?</p>
</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  

  

</ol>
      </li>
      
    
      
      <li>
        <article id="comment-28">
          <div class="d-flex">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/2F963E7CE863DCFAF71AC829FA376B39?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Vincent
                
              </div>
              <small>
                <a href="#comment-28" title="Link naar deze reactie">
                  <time>Monday 30 Nov 2015 om 12:24:31</time>
                  
                </a>
              </small>
              <p><p>Quite late to the party, but FYI: your version 1 code &ndash;&gt; mask = 10000000; //reset mask</p>

<p>This will never work&hellip; You&rsquo;re missing a &lsquo;binary&rsquo; indicator, so you&rsquo;re setting your mask to 10000000 DECIMAL, not binary. So you&rsquo;re masking with 11110100001001000000b instead of 10000000b :)</p>
</p>
            </div>
          </div>
          <hr class="blog-seperator"/>
        </article>
        <ol class="children">

  

  

  
    <li>
      <article id="comment-29">
          <div class="d-flex flex-row">
            <div>
                <img class="avatar" src="https://secure.gravatar.com/avatar/7F2A9FD369018735070D34C0331FE9C5?s=100&d=mm&r=g">
            </div>
            <div>
              <div class="author">
                Rogier Reedijk reply to Vincent
                
              </div>
              <small>
                <a href="#comment-29" title="Link naar deze reactie">
                  <time>Wednesday 2 Dec 2015 om 21:40:39</time>
                  
                </a>
              </small>
              <p><p>Wow! Thanks for replying Vincent! I really didn&rsquo;t notice this rather big mistake. I would really love to edit and run the first fixed version of the code again and see if it works. But I am currently in the process of moving to another house, so all my electronics have already been stored in boxes. Most likely it will take me at least 2 months to unpack everything and get settled, so this will have to wait.
If you do use the code and get the first version working, please do share your experiences in the comments.</p>

<p>In the mean time I will update this blog with your correction and also change the code on GitHub.
Thanks for the sharp look at my code!</p>
</p>
            </div>
          </div>      
        </article>
        <hr class="blog-seperator"/>
    </li>
  

</ol>
      </li>
      
    
      
    
    </ol>
  

  
</section>
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
